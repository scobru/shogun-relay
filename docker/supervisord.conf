[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:ipfs-init]
command=/app/docker/init-ipfs.sh
user=ipfs
autostart=true
autorestart=false
startsecs=0
priority=100
stdout_logfile=/var/log/supervisor/ipfs-init.log
stderr_logfile=/var/log/supervisor/ipfs-init.log

[program:ipfs-daemon]
command=bash -c "mkdir -p /home/ipfs/.config/ipfs/denylists /root/.config/ipfs/denylists && chmod -R 755 /home/ipfs/.config /root/.config 2>/dev/null || true && rm -f /data/ipfs/repo.lock && /usr/local/bin/ipfs daemon --migrate=true --agent-version-suffix=docker"
user=ipfs
autostart=true
autorestart=true
startsecs=10
priority=200
environment=IPFS_PATH="/data/ipfs",HOME="/home/ipfs"
stdout_logfile=/var/log/supervisor/ipfs.log
stderr_logfile=/var/log/supervisor/ipfs.log
depends_on=ipfs-init

[program:fakes3]
command=/usr/local/bin/node index.js
directory=/app/fakes3
user=node
autostart=true
autorestart=true
startsecs=5
priority=300
stdout_logfile=/var/log/supervisor/fakes3.log
stderr_logfile=/var/log/supervisor/fakes3.log

[program:relay]
command=/usr/local/bin/node src/index.js
directory=/app/relay
user=node
autostart=true
autorestart=true
startsecs=10
priority=400
stdout_logfile=/var/log/supervisor/relay.log
stderr_logfile=/var/log/supervisor/relay.log
depends_on=fakes3

[group:shogun-stack]
programs=ipfs-daemon,fakes3,relay
priority=999 