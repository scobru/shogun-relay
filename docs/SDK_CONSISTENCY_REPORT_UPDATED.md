# SDK Consistency Report - Aggiornato

**Data analisi:** 2025-01-27

## Stato Attuale

### âœ… Problemi Risolti

1. **SystemModule.getStats()** - âœ… Corretto
   - Ora usa correttamente `/api/v1/system/stats`

2. **IpfsModule.pinAdd() e pinRm()** - âœ… Corretto
   - Ora usano body JSON `{cid}` invece di query params

### âš ï¸ Problemi Rimanenti

1. **DealsModule.grief()** - Endpoint nel modulo sbagliato
   - **SDK:** `DealsModule.grief()` â†’ `/api/v1/registry/deal/grief`
   - **Relay:** Endpoint Ã¨ in `routes/registry.js`
   - **Raccomandazione:** Spostare in `RegistryModule` per coerenza, oppure mantenere se c'Ã¨ una logica specifica per i deals

## Analisi Dettagliata per Modulo

### 1. SystemModule âœ…

**SDK Metodi:**
- `getHealth()` â†’ `/api/v1/health` âœ…
- `getStats()` â†’ `/api/v1/system/stats` âœ…

**Relay Endpoints disponibili:**
- `/api/v1/health` âœ…
- `/api/v1/system/health` âš ï¸ (mancante in SDK)
- `/api/v1/system/stats` âœ…
- `/api/v1/system/alldata` âš ï¸ (mancante in SDK)
- `/api/v1/system/stats/update` âš ï¸ (mancante in SDK)
- `/api/v1/system/node/*` âš ï¸ (mancante in SDK)

**Status:** âœ… Base funzionale, ma mancano alcuni endpoint avanzati

### 2. IpfsModule âœ…

**SDK Metodi:**
- `getStatus()` â†’ `/api/v1/ipfs/status` âœ…
- `uploadFile()` â†’ `/api/v1/ipfs/upload` âœ…
- `cat()` â†’ `/api/v1/ipfs/cat/${cid}` âœ…
- `pinAdd()` â†’ `/api/v1/ipfs/pin/add` âœ… (corretto)
- `pinRm()` â†’ `/api/v1/ipfs/pin/rm` âœ… (corretto)
- `pinLs()` â†’ `/api/v1/ipfs/pin/ls` âœ…

**Relay Endpoints disponibili:**
- `/api/v1/ipfs/upload` âœ…
- `/api/v1/ipfs/status` âœ…
- `/api/v1/ipfs/cat/:cid` âœ…
- `/api/v1/ipfs/cat/:cid/json` âš ï¸ (mancante in SDK)
- `/api/v1/ipfs/cat/:cid/decrypt` âš ï¸ (mancante in SDK)
- `/api/v1/ipfs/pin/add` âœ…
- `/api/v1/ipfs/pin/rm` âœ…
- `/api/v1/ipfs/pin/ls` âœ…
- `/api/v1/ipfs/repo/gc` âš ï¸ (mancante in SDK)
- `/api/v1/ipfs/repo/stat` âš ï¸ (mancante in SDK)
- `/api/v1/ipfs/version` âš ï¸ (mancante in SDK)
- `/api/v1/ipfs/user-uploads/:userAddress` âš ï¸ (mancante in SDK)

**Status:** âœ… Base funzionale, ma mancano endpoint avanzati (decrypt, repo operations)

### 3. X402Module âœ…

**SDK Metodi:**
- `getTiers()` â†’ `/api/v1/x402/tiers` âœ…
- `getSubscription()` â†’ `/api/v1/x402/subscription/${userAddress}` âœ…
- `subscribe()` â†’ `/api/v1/x402/subscribe` âœ…
- `getPaymentRequirements()` â†’ `/api/v1/x402/payment-requirements/${tier}` âœ…
- `canUpload()` â†’ `/api/v1/x402/can-upload/${userAddress}` âœ…
- `getStorageUsage()` â†’ `/api/v1/x402/storage/${userAddress}` âœ…

**Relay Endpoints disponibili:**
- `/api/v1/x402/tiers` âœ…
- `/api/v1/x402/subscription/:userAddress` âœ…
- `/api/v1/x402/subscribe` âœ…
- `/api/v1/x402/payment-requirements/:tier` âœ…
- `/api/v1/x402/can-upload/:userAddress` âœ…
- `/api/v1/x402/can-upload-verified/:userAddress` âš ï¸ (mancante in SDK)
- `/api/v1/x402/storage/:userAddress` âœ…
- `/api/v1/x402/storage/sync/:userAddress` âš ï¸ (mancante in SDK - admin only)
- `/api/v1/x402/config` âš ï¸ (mancante in SDK)
- `/api/v1/x402/relay-storage` âš ï¸ (mancante in SDK)
- `/api/v1/x402/recommend` âš ï¸ (mancante in SDK)

**Status:** âœ… Base funzionale, ma mancano endpoint avanzati (verified upload check, recommendations)

### 4. NetworkModule âœ…

**SDK Metodi:**
- `getRelays()` â†’ `/api/v1/network/relays` âœ…
- `getRelay()` â†’ `/api/v1/network/relay/${host}` âœ…
- `getStats()` â†’ `/api/v1/network/stats` âœ…
- `getProof()` â†’ `/api/v1/network/proof/${cid}` âœ…
- `verifyProof()` â†’ `/api/v1/network/verify-proof` âœ…
- `getReputation()` â†’ `/api/v1/network/reputation/${host}` âœ…
- `getReputationLeaderboard()` â†’ `/api/v1/network/reputation` âœ…

**Relay Endpoints disponibili:**
- `/api/v1/network/relays` âœ…
- `/api/v1/network/relay/:host` âœ…
- `/api/v1/network/stats` âœ…
- `/api/v1/network/proof/:cid` âœ…
- `/api/v1/network/verify-proof` âœ…
- `/api/v1/network/pin-request` âš ï¸ (mancante in SDK - admin only)
- `/api/v1/network/pin-requests` âš ï¸ (mancante in SDK)
- `/api/v1/network/pin-response` âš ï¸ (mancante in SDK)
- `/api/v1/network/reputation/:host` âœ…
- `/api/v1/network/reputation` âœ…
- `/api/v1/network/reputation/record-proof` âš ï¸ (mancante in SDK)
- `/api/v1/network/best-relays` âš ï¸ (mancante in SDK)
- `/api/v1/network/verified/relays` âš ï¸ (mancante in SDK)
- `/api/v1/network/verified/relay/:host` âš ï¸ (mancante in SDK)
- `/api/v1/network/verified/observation` âš ï¸ (mancante in SDK)
- `/api/v1/network/verified/observations/:host` âš ï¸ (mancante in SDK)
- `/api/v1/network/verified/entry/:namespace/:hash` âš ï¸ (mancante in SDK)
- `/api/v1/network/onchain/relays` âš ï¸ (mancante in SDK)
- `/api/v1/network/onchain/relay/:address` âš ï¸ (mancante in SDK)
- `/api/v1/network/onchain/deals/relay/:address` âš ï¸ (mancante in SDK)
- `/api/v1/network/onchain/deals/client/:address` âš ï¸ (mancante in SDK)
- `/api/v1/network/onchain/params` âš ï¸ (mancante in SDK)

**Status:** âœ… Base funzionale, ma mancano molti endpoint avanzati (verified data, on-chain queries, pin coordination)

### 5. DealsModule âš ï¸

**SDK Metodi:**
- `getPricing()` â†’ `/api/v1/deals/pricing` âœ…
- `uploadForDeal()` â†’ `/api/v1/deals/upload` âœ…
- `createDeal()` â†’ `/api/v1/deals/create` âœ…
- `activateDeal()` â†’ `/api/v1/deals/${dealId}/activate` âœ…
- `getDealsByCid()` â†’ `/api/v1/deals/by-cid/${cid}` âœ…
- `getDealsByClient()` â†’ `/api/v1/deals/by-client/${address}` âœ…
- `grief()` â†’ `/api/v1/registry/deal/grief` âš ï¸ (endpoint nel modulo sbagliato)

**Relay Endpoints disponibili:**
- `/api/v1/deals/pricing` âœ…
- `/api/v1/deals/overhead` âš ï¸ (mancante in SDK)
- `/api/v1/deals/upload` âœ…
- `/api/v1/deals/create` âœ…
- `/api/v1/deals/:dealId` âš ï¸ (mancante in SDK)
- `/api/v1/deals/:dealId/activate` âœ…
- `/api/v1/deals/:dealId/renew` âš ï¸ (mancante in SDK)
- `/api/v1/deals/:dealId/terminate` âš ï¸ (mancante in SDK - admin only)
- `/api/v1/deals/:dealId/cancel` âš ï¸ (mancante in SDK)
- `/api/v1/deals/:dealId/report` âš ï¸ (mancante in SDK)
- `/api/v1/deals/:dealId/verify` âš ï¸ (mancante in SDK)
- `/api/v1/deals/:dealId/verify-proof` âš ï¸ (mancante in SDK)
- `/api/v1/deals/by-cid/:cid` âœ…
- `/api/v1/deals/by-client/:address` âœ…
- `/api/v1/deals/relay/active` âš ï¸ (mancante in SDK - admin only)
- `/api/v1/deals/stats` âš ï¸ (mancante in SDK)
- `/api/v1/deals/leaderboard` âš ï¸ (mancante in SDK)
- `/api/v1/deals/sync` âš ï¸ (mancante in SDK - admin only)
- `/api/v1/deals/sync/status` âš ï¸ (mancante in SDK - admin only)

**Status:** âš ï¸ Base funzionale, ma mancano molti endpoint importanti (verify, renew, cancel, stats)

### 6. RegistryModule âœ…

**SDK Metodi:**
- `getStatus()` â†’ `/api/v1/registry/status` âœ…
- `getBalance()` â†’ `/api/v1/registry/balance` âœ…
- `registerRelay()` â†’ `/api/v1/registry/register` âœ…
- `updateRelay()` â†’ `/api/v1/registry/update` âœ…
- `increaseStake()` â†’ `/api/v1/registry/stake/increase` âœ…
- `requestUnstake()` â†’ `/api/v1/registry/stake/unstake` âœ…
- `withdrawStake()` â†’ `/api/v1/registry/stake/withdraw` âœ…
- `getDeals()` â†’ `/api/v1/registry/deals` âœ…
- `griefMissedProof()` â†’ `/api/v1/registry/grief/missed-proof` âœ…
- `griefDataLoss()` â†’ `/api/v1/registry/grief/data-loss` âœ…

**Relay Endpoints disponibili:**
- `/api/v1/registry/status` âœ…
- `/api/v1/registry/balance` âœ…
- `/api/v1/registry/params` âš ï¸ (mancante in SDK)
- `/api/v1/registry/config` âš ï¸ (mancante in SDK)
- `/api/v1/registry/register` âœ…
- `/api/v1/registry/update` âœ…
- `/api/v1/registry/stake/increase` âœ…
- `/api/v1/registry/stake/unstake` âœ…
- `/api/v1/registry/stake/withdraw` âœ…
- `/api/v1/registry/deal/register` âš ï¸ (mancante in SDK)
- `/api/v1/registry/deal/complete` âš ï¸ (mancante in SDK)
- `/api/v1/registry/deals` âœ…
- `/api/v1/registry/grief/missed-proof` âœ…
- `/api/v1/registry/grief/data-loss` âœ…
- `/api/v1/registry/deal/grief` âš ï¸ (presente in DealsModule, dovrebbe essere qui)

**Status:** âœ… Base funzionale, ma mancano alcuni endpoint (params, config, deal operations)

### 7. UploadsModule âœ…

**SDK Metodi:**
- `getUserUploads()` â†’ `/api/v1/user-uploads/${identifier}` âœ…
- `deleteUpload()` â†’ `/api/v1/user-uploads/${identifier}/${hash}` âœ…
- `getSystemHashes()` â†’ `/api/v1/user-uploads/system-hashes` âœ…

**Relay Endpoints disponibili:**
- `/api/v1/user-uploads/system-hashes` âœ…
- `/api/v1/user-uploads/system-hashes-map` âš ï¸ (mancante in SDK)
- `/api/v1/user-uploads/save-system-hash` âš ï¸ (mancante in SDK - admin only)
- `/api/v1/user-uploads/remove-system-hash/:hash` âš ï¸ (mancante in SDK - admin only)
- `/api/v1/user-uploads/:identifier` âœ…
- `/api/v1/user-uploads/:identifier/:hash` âœ… (DELETE)

**Status:** âœ… Base funzionale, ma mancano endpoint per system-hashes management

## Riepilogo Endpoint Mancanti nell'SDK

### Critici (funzionalitÃ  base)
1. `DealsModule.getDeal(dealId)` - Ottenere info di un deal specifico
2. `DealsModule.verifyDeal(dealId)` - Verificare che un deal sia valido
3. `IpfsModule.catJson(cid)` - Ottenere contenuto IPFS come JSON
4. `IpfsModule.catDecrypt(cid, token)` - Decriptare contenuto IPFS

### Importanti (funzionalitÃ  avanzate)
1. `DealsModule.renewDeal(dealId, additionalDays, payment)` - Rinnovare un deal
2. `DealsModule.cancelDeal(dealId, clientAddress)` - Cancellare un deal
3. `DealsModule.getDealStats()` - Statistiche aggregate
4. `X402Module.canUploadVerified(userAddress, sizeMB)` - Verifica upload con IPFS
5. `X402Module.getRecommendation(fileSizeMB, durationDays, userAddress?)` - Raccomandazione tier
6. `NetworkModule.getBestRelays(count, minScore)` - Migliori relay per replicazione
7. `NetworkModule.getOnChainRelays(chainId?)` - Relay dal registry on-chain

### Opzionali (admin/avanzati)
1. `SystemModule.getAllData()` - Tutti i dati GunDB
2. `SystemModule.updateStats(key, value)` - Aggiornare statistiche
3. `IpfsModule.repoGC()` - Garbage collection IPFS
4. `IpfsModule.repoStat()` - Statistiche repository IPFS
5. `X402Module.syncStorage(userAddress)` - Sincronizzare storage (admin)
6. `DealsModule.terminateDeal(dealId, reason)` - Terminare deal (admin)
7. `DealsModule.getRelayActiveDeals()` - Deal attivi del relay (admin)
8. `NetworkModule.requestPin(cid, replicationFactor)` - Richiedere pin (admin)
9. `NetworkModule.getPinRequests()` - Lista richieste pin
10. `RegistryModule.getParams()` - Parametri registry
11. `RegistryModule.getConfig()` - Configurazione registry

## Raccomandazioni

### PrioritÃ  Alta
1. âœ… **Completato:** Fix pinAdd/pinRm (giÃ  fatto)
2. âœ… **Completato:** Fix getStats() (giÃ  fatto)
3. âš ï¸ **Da fare:** Spostare `grief()` da DealsModule a RegistryModule o creare wrapper
4. ğŸ”´ **Da fare:** Aggiungere `getDeal(dealId)` in DealsModule
5. ğŸ”´ **Da fare:** Aggiungere `verifyDeal(dealId)` in DealsModule
6. ğŸ”´ **Da fare:** Aggiungere `catJson()` e `catDecrypt()` in IpfsModule

### PrioritÃ  Media
1. Aggiungere endpoint per deal lifecycle (renew, cancel)
2. Aggiungere endpoint per verified upload check
3. Aggiungere endpoint per recommendations
4. Aggiungere endpoint per on-chain queries

### PrioritÃ  Bassa
1. Aggiungere endpoint admin-only
2. Aggiungere endpoint per statistiche avanzate
3. Aggiungere endpoint per pin coordination

## Conclusione

**Stato Generale:** âœ… **Buono**

L'SDK copre le funzionalitÃ  base necessarie per l'uso comune. I problemi critici precedenti sono stati risolti. Rimangono alcuni endpoint mancanti per funzionalitÃ  avanzate, ma non bloccano l'uso base dell'SDK.

**Prossimi Passi:**
1. Risolvere il problema di `grief()` (spostare o documentare)
2. Aggiungere endpoint critici mancanti (getDeal, verifyDeal, catJson, catDecrypt)
3. Considerare aggiunta endpoint importanti per completezza
