<!DOCTYPE HTML>
<html lang="en" data-theme="shogun-dark">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gun Relay Advanced Stats</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/shogun-theme@1.0.0/styles/variables.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/shogun-theme@1.0.0/styles/base.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/shogun-theme@1.0.0/styles/daisyui-overrides.css" rel="stylesheet" type="text/css" />
<link href="styles/wormhole.css" rel="stylesheet" type="text/css" />
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
<script src="lib/admin-nav.js"></script>
<script src="lib/admin-auth.js"></script>
<style>
	body {
		background: linear-gradient(135deg, #1A1A1A 0%, #0D0D0D 100%);
		color: #E0E0E0 !important;
		margin: 0;
		padding: 1em;
		line-height: 1.6;
		min-height: 100vh;
	}

	.hero-gradient {
		background: radial-gradient(ellipse at top, rgba(255, 105, 180, 0.1) 0%, transparent 60%);
	}

	h1 {
		border-bottom: 1px solid #404040;
		padding-bottom: 10px;
		color: #FF69B4;
		font-size: 1.5rem;
	}

	@media (min-width: 640px) {
		h1 {
			font-size: 1.75rem;
		}
	}

	@media (min-width: 768px) {
		body {
			padding: 1.5em;
		}
		h1 {
			font-size: 2rem;
		}
	}

	@keyframes pulse-glow {
		0%, 100% { box-shadow: 0 0 0 0 rgba(255, 105, 180, 0.4); }
		50% { box-shadow: 0 0 20px 5px rgba(255, 105, 180, 0.2); }
	}

	.pulse-glow {
		animation: pulse-glow 2s infinite;
	}

	.card-hover {
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.card-hover:hover {
		transform: translateY(-4px);
		box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
	}

	.section-divider {
		height: 1px;
		background: linear-gradient(90deg, transparent, #404040, transparent);
		margin: 2rem 0;
	}

	a {
		color: #42A5F5;
		text-decoration: none;
	}

	a:hover {
		background-color: #404040;
		color: #64B5F6;
	}

	.center {
		text-align: center;
		margin: 1em 0;
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		gap: 0.5rem 1rem;
	}

	.stat-pair {
		display: inline-flex;
		align-items: center;
		margin: 0 0.25rem;
	}

	.shout {
		color: #FF69B4;
		font-weight: bold;
		font-size: 1.2em;
		text-shadow: 1px 1px 10px rgba(255, 105, 180, 0.3);
		margin-right: 0.25rem;
	}

	.label {
		position: absolute;
		left: 0.5em;
		top: 1.75em;
		color: #FF69B4;
		font-size: 0.9em;
	}

	.input {
		height: 30px;
		padding: 10px;
		background-color: #404040;
		color: #FFFFFF;
		border: 1px solid #606060;
		margin: 10px 0;
		width: 100%;
		max-width: 600px;
		border-radius: 0.5rem;
	}

	.tall { 
		height: 200px; 
		width: 100%;
	}

	.charts {
		display: grid;
		grid-template-columns: 1fr;
		gap: 20px;
		margin-top: 20px;
	}

	@media (min-width: 640px) {
		.charts {
			grid-template-columns: repeat(2, 1fr);
		}
	}

	@media (min-width: 1024px) {
		.charts {
			grid-template-columns: repeat(2, 1fr);
		}
	}

	@media (min-width: 1280px) {
		.charts {
			grid-template-columns: repeat(3, 1fr);
		}
	}

	.chart {
		position: relative;
		border: 1px solid #404040;
		background-color: #282828;
		padding: 15px;
		margin: 0;
		border-radius: 1rem;
		box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
	}

	.chart canvas {
		width: 100% !important;
		height: 200px !important;
		margin-top: 25px;
	}

	.model {
		display: none;
	}

	.topbar {
		background-color: #282828;
		padding: 15px;
		border: 1px solid #404040;
		margin-bottom: 20px;
		border-radius: 1rem;
	}

	.status {
		margin-top: 10px;
		font-size: 12px;
		color: #A0A0A0;
	}

	.stats {
		width: 100%;
		max-width: 600px;
		margin: 1rem auto;
	}

	.input-custom {
		width: 100%;
		padding: 0.5rem;
		background-color: #404040;
		color: #FFFFFF;
		border: 1px solid #606060;
		border-radius: 0.5rem;
	}
</style>
</head>
<body class="antialiased">
<div class="hero-gradient min-h-screen">
	<div class="container mx-auto px-4 py-8 max-w-6xl">
		<!-- Back Navigation -->
		<div class="flex items-center mb-8">
			<a href="/" class="flex items-center gap-2 text-[#A0A0A0] hover:text-[#FF69B4] transition-colors group">
				<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
				</svg>
				<span>Back to Control Panel</span>
			</a>
		</div>

		<div class="card bg-[#282828] border border-[#404040] rounded-2xl card-hover">
			<div class="p-4 sm:p-6 md:p-8">
				<div class="flex flex-col items-center">
					<!-- Header Icon -->
					<div class="inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 rounded-2xl bg-gradient-to-br from-[#FF69B4] to-[#FF1493] mb-6 pulse-glow">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 sm:h-10 sm:w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
						</svg>
					</div>
					
					<h1 class="text-center mb-2 sm:mb-4 text-2xl sm:text-3xl font-bold">Gun Relay Advanced Stats</h1>
					<p class="text-[#8B94FF] mb-6 sm:mb-8">Real-time performance charts and metrics</p>

				<div class="center">
					<div class="stat-pair"><span class="shout" id="peers">0</span> peers</div>
					<div class="stat-pair"><span class="shout" id="time">0</span> min</div>
					<div class="stat-pair"><span class="shout" id="nodes">0</span> nodes</div>
					<div class="stat-pair"><span class="shout" id="hours">0</span> hours</div>
					<div class="stat-pair"><span class="shout" id="block">0</span> ms avg</div>
					<div class="stat-pair"><span class="shout" id="stack">0</span> gets/s</div>
				</div>

				<div class="stats">
					<label for="url" class="text-[#FFFFFF]">Stats Source URL:</label>
					<input id="url" class="input-custom" placeholder="Enter custom stats source URL (optional)" value="">
					<div class="text-[#A0A0A0] text-sm mt-2" id="status">Connecting to local stats...</div>
				</div>

				<div id="charts" class="charts">
					<!-- Charts will be injected here -->
				</div>

				<div class="model">
					<div class="chart"><span class="label"></span><canvas class="tall"></canvas></div>
				</div>
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer class="mt-12 text-center pb-8">
		<div class="section-divider"></div>
		<p class="text-[#606060] text-sm">
			Shogun Relay Charts - Part of the <a href="https://github.com/scobru/shogun" class="text-[#FF69B4] hover:text-[#FF1493] transition-colors">Shogun Project</a>
		</p>
	</footer>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/smoothie@1.36.1/smoothie.min.js"></script>
<script>
  var up, br = 0, bt = 0, tmp;

  var fetchData = async function(){
    var requestStart = +new Date;
    
    try {
      var url = document.getElementById('url').value || (location.origin + '/api/v1/system/stats.json');
      var data = await (await fetch(url, {method: 'GET', mode: 'cors'})).json();
      
      var requestEnd = +new Date;
      var requestTime = requestEnd - requestStart;
      
      $('#block').text(((br += requestTime) / ++bt).toFixed(1));
      
      data.over = (data.over/1000) || 5;
      $('#peers').text(data.peers.count || 0);
      $('#time').text(((data.peers.time || 0) / 1000 / 60).toFixed(0));
      $('#nodes').text(data.node.count || 0);
      $('#hours').text(((data.up.time || 0) / 60 / 60 / 1000).toFixed(1));
      
      var getRate = data.dam?.in?.rate || 0;
      $('#stack').text(getRate.toFixed(1));
      
      if(data.up.time === up){ 
        console.log("Up time same as before"); 
      } 
      up = data.up.time;

      $('#status').text(`Connected • Last update: ${new Date().toLocaleTimeString()} • Request: ${requestTime}ms`);

      Stats('peers#').line.append(requestEnd, data.peers.count || 0);
      Stats('memory MB').line.append(requestEnd, (data.memory?.heapUsed || 0) / 1024 / 1024);
      
      if (data.dam) {
        Stats('GET requests/s').line.append(requestEnd, data.dam.in?.rate || 0);
        Stats('PUT requests/s').line.append(requestEnd, data.dam.out?.rate || 0);
        Stats('Total GETs').line.append(requestEnd, data.dam.in?.count || 0);
        Stats('Total PUTs').line.append(requestEnd, data.dam.out?.count || 0);
      }

      console.log('Stats data:', data);

      if (data.all) {
        $.each(data.all, function(key, arr){
          if (arr && arr.length > 0) {
            var chart = Stats(key);
            // Add the latest data point from the server
            var latestPoint = arr[arr.length - 1];
            if (latestPoint && latestPoint.length >= 2 && !isNaN(latestPoint[1])) {
              chart.line.append(latestPoint[0], latestPoint[1]);
            }
          }
        });
      }

    } catch(error) {
      console.error('Error fetching stats:', error);
      $('#status').text(`Error: ${error.message}`).css('color', '#ff0000');
    }
  }

  setInterval(fetchData, 5000);
  fetchData();

  function Stats(key, chart){
    if(chart = Stats[key]){
      return chart;
    }
    
    chart = Stats[key] = new SmoothieChart({
      millisPerPixel: 200,
      limitFPS: 30,
      responsive: true,
      minValue: 0,
      grid: {
        strokeStyle: 'rgba(255,105,180,0.3)',
        fillStyle: 'transparent',
        lineWidth: 1,
        millisPerLine: 30000,
        verticalSections: 5
      },
      labels: {
        fontSize: 12,
        fillStyle: '#FF69B4',
        precision: 2
      },
      interpolation: 'linear',
      maxValue: undefined,
      minValue: 0
    });
    
    chart.line = new TimeSeries();
    
    var hash = 0;
    for (var i = 0; i < key.length; i++) {
      hash = ((hash << 5) - hash + key.charCodeAt(i)) & 0xffffffff;
    }
    var r = Math.max(100, (hash & 0xFF0000) >> 16);
    var g = Math.max(100, (hash & 0x00FF00) >> 8);
    var b = Math.max(100, hash & 0x0000FF);
    
    chart.addTimeSeries(chart.line, {
      strokeStyle: `rgb(${r}, ${g}, ${b})`,
      lineWidth: 2
    });
    
    chart.canvas = $('.model').find('.chart').clone(true).appendTo('#charts');
    chart.canvas.find('.label').text(key);
    chart.canvas.show();
    
    chart.streamTo(chart.canvas.find('canvas').get(0), 5000);
    chart.line.append(Date.now(), 0);
    
    return chart;
  }

  $('#url').on('change', function() {
    $('#status').text('Switching to custom URL...');
    fetchData();
  });

  // Handle responsive resizing
  function handleResize() {
    const charts = document.querySelectorAll('.chart canvas');
    charts.forEach(canvas => {
      if (canvas._chart) {
        canvas._chart.resize();
      }
    });
  }

  window.addEventListener('resize', handleResize);
</script>
</body>
</html> 