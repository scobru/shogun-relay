<!DOCTYPE html>
<html lang="en" data-theme="shogun-dark">
<head>
    <meta charset="UTF-8">
    <title>API Documentation - Shogun Relay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/shogun-theme@1.0.0/styles/variables.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/shogun-theme@1.0.0/styles/base.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/shogun-theme@1.0.0/styles/daisyui-overrides.css" rel="stylesheet" type="text/css" />
    <link href="styles/wormhole.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- RapiDoc - Using UMD version for better compatibility -->
    <script src="https://unpkg.com/rapidoc@9.3.4/dist/rapidoc-min.js"></script>
    
    <style>
        body {
            line-height: 1.6;
            background: linear-gradient(135deg, #1A1A1A 0%, #0D0D0D 100%);
            min-height: 100vh;
        }

        .hero-gradient {
            background: radial-gradient(ellipse at top, rgba(255, 105, 180, 0.1) 0%, transparent 60%);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: #42A5F5;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .back-link:hover {
            background-color: rgba(66, 165, 245, 0.1);
            color: #64B5F6;
        }

        /* Override RapiDoc styles for dark theme */
        :root {
            --rapidoc-primary-color: #FF69B4;
            --rapidoc-bg-color: #1A1A1A;
            --rapidoc-text-color: #E0E0E0;
            --rapidoc-border-color: #404040;
            --rapidoc-nav-bg-color: #282828;
            --rapidoc-nav-hover-bg-color: #353535;
            --rapidoc-nav-text-color: #E0E0E0;
            --rapidoc-nav-accent-color: #FF69B4;
        }

        rapidoc {
            --nav-hover-bg-color: #353535;
            --nav-active-bg-color: #404040;
            --nav-active-text-color: #FF69B4;
            --nav-group-title-color: #FF69B4;
            --nav-tag-color: #42A5F5;
            --nav-text-color: #E0E0E0;
            --nav-bg-color: #282828;
            --bg-color: #1A1A1A;
            --text-color: #E0E0E0;
            --border-color: #404040;
            --primary-color: #FF69B4;
            --code-bg-color: #282828;
            --code-text-color: #E0E0E0;
            --param-bg-color: #282828;
            --param-text-color: #E0E0E0;
            --param-border-color: #404040;
            --btn-primary-bg-color: #FF69B4;
            --btn-primary-text-color: #FFFFFF;
            --btn-secondary-bg-color: #404040;
            --btn-secondary-text-color: #E0E0E0;
            --response-bg-color: #282828;
            --response-text-color: #E0E0E0;
            --response-border-color: #404040;
        }
    </style>
</head>

<body class="antialiased">
    <div class="hero-gradient min-h-screen">
        <div class="container mx-auto px-4 py-8">
            <!-- Back Navigation -->
            <div class="flex items-center mb-8">
                <a href="/" class="back-link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    <span>Back to Control Panel</span>
                </a>
            </div>

            <div class="card bg-[#282828] border border-[#404040] rounded-2xl mb-8">
                <div class="p-8">
                    <div class="flex flex-col items-center mb-6">
                        <div class="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-[#42A5F5] to-[#1E88E5] mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <h1 class="text-3xl md:text-4xl font-bold mb-4 text-[#FFFFFF]">API Documentation</h1>
                        <p class="text-[#8B94FF] mb-4 text-center">Interactive API explorer - Test endpoints directly from your browser</p>
                    </div>
                </div>
            </div>

            <!-- Loading indicator -->
            <div id="loadingIndicator" class="card bg-[#282828] border border-[#404040] rounded-2xl p-8 text-center">
                <div class="text-[#FF69B4] mb-4">Loading API documentation...</div>
                <div class="text-[#A0A0A0] text-sm">Fetching OpenAPI specification from /api/openapi.json</div>
            </div>

            <!-- RapiDoc Component -->
            <rapidoc
                id="rapidoc-element"
                spec-url="/api/openapi.json"
                theme="dark"
                render-style="read"
                show-header="false"
                allow-authentication="true"
                allow-server-selection="false"
                show-meta="true"
                show-components="true"
                show-info="true"
                show-servers="true"
                regular-font="'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
                mono-font="'Fira Code', 'Courier New', monospace"
                font-size="14px"
                primary-color="#FF69B4"
                bg-color="#1A1A1A"
                text-color="#E0E0E0"
                nav-bg-color="#282828"
                nav-text-color="#E0E0E0"
                nav-hover-bg-color="#353535"
                nav-accent-color="#FF69B4"
                nav-hover-text-color="#FF69B4"
                header-color="#FF69B4"
                border-color="#404040"
                default-schema-tab="example"
                show-schema-description="true"
                schema-style="table"
                schema-expand-level="2"
                style="display: none;"
            ></rapidoc>
        </div>
    </div>

    <!-- Include centralized admin authentication -->
    <script src="lib/admin-auth.js"></script>
    <script src="lib/admin-nav.js"></script>

    <script>
        // Wait for DOM and RapiDoc to be ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('API Documentation page loaded');
            
            const loadingIndicator = document.getElementById('loadingIndicator');
            const rapidocEl = document.getElementById('rapidoc-element');
            
            // First, test if the endpoint is accessible
            fetch('/api/openapi.json')
                .then(response => {
                    console.log('OpenAPI endpoint response status:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(spec => {
                    console.log('‚úÖ OpenAPI spec loaded successfully:', spec.info?.title || 'Unknown');
                    console.log('üìä Number of paths:', Object.keys(spec.paths || {}).length);
                    
                    // Wait a bit for RapiDoc to initialize, then show it
                    setTimeout(() => {
                        if (rapidocEl) {
                            // Check if RapiDoc has loaded the spec
                            if (rapidocEl.shadowRoot) {
                                console.log('‚úÖ RapiDoc shadow root found');
                                loadingIndicator.style.display = 'none';
                                rapidocEl.style.display = 'block';
                            } else {
                                // Force show after a delay
                                setTimeout(() => {
                                    loadingIndicator.style.display = 'none';
                                    rapidocEl.style.display = 'block';
                                }, 1000);
                            }
                        }
                    }, 500);
                })
                .catch(error => {
                    console.error('‚ùå Error loading OpenAPI spec:', error);
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = `
                            <div style="color: #F44336; margin-bottom: 1rem;">
                                <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Error loading API documentation</h2>
                                <p style="color: #A0A0A0; font-size: 0.9rem;">${error.message}</p>
                            </div>
                            <div style="margin-top: 1rem;">
                                <a href="/api/openapi.json" target="_blank" style="color: #42A5F5; text-decoration: underline;">
                                    Try opening the spec directly
                                </a>
                            </div>
                        `;
                    }
                });
            
            // Monitor RapiDoc events if available
            if (rapidocEl) {
                // Listen for RapiDoc custom events
                rapidocEl.addEventListener('spec-loaded', (e) => {
                    console.log('‚úÖ RapiDoc spec loaded event fired');
                    if (loadingIndicator) loadingIndicator.style.display = 'none';
                    rapidocEl.style.display = 'block';
                });
                
                rapidocEl.addEventListener('spec-error', (e) => {
                    console.error('‚ùå RapiDoc spec error:', e.detail);
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = `
                            <div style="color: #F44336;">
                                <h2>RapiDoc Error</h2>
                                <p>${e.detail || 'Unknown error'}</p>
                            </div>
                        `;
                    }
                });
                
                // Fallback: Check after 3 seconds if RapiDoc loaded
                setTimeout(() => {
                    if (loadingIndicator && loadingIndicator.style.display !== 'none') {
                        // Try to manually load the spec
                        fetch('/api/openapi.json')
                            .then(r => r.json())
                            .then(spec => {
                                if (rapidocEl.setAttribute) {
                                    rapidocEl.setAttribute('spec', JSON.stringify(spec));
                                    loadingIndicator.style.display = 'none';
                                    rapidocEl.style.display = 'block';
                                }
                            })
                            .catch(err => console.error('Fallback load failed:', err));
                    }
                }, 3000);
            }
        });
    </script>
</body>
</html>
