<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>API Documentation - Shogun Relay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/google-md3.css">
    <script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
    <style>
        .page-header {
            background-color: var(--md-surface-container-low);
            border-bottom: 1px solid var(--md-outline-variant);
            padding: 24px;
            margin-bottom: 24px;
        }

        .page-header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .page-icon {
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            background: linear-gradient(135deg, #42A5F5, #1E88E5);
            box-shadow: 0 8px 24px rgba(66, 165, 245, 0.3);
        }

        .page-icon svg {
            width: 28px;
            height: 28px;
            color: white;
        }

        .docs-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 24px 24px;
        }

        .loading-card {
            background-color: var(--md-surface-container);
            border: 1px solid var(--md-outline-variant);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
        }

        .loading-text {
            color: var(--md-primary);
            margin-bottom: 8px;
        }

        .loading-subtext {
            color: var(--md-on-surface-variant);
            font-size: 0.875rem;
        }

        /* RapiDoc styling overrides for dark theme */
        rapi-doc {
            --nav-hover-bg-color: #353535;
            --nav-active-bg-color: #404040;
            --nav-active-text-color: #FF69B4;
            --nav-group-title-color: #FF69B4;
            --nav-tag-color: #42A5F5;
            --nav-text-color: #E0E0E0;
            --nav-bg-color: #282828;
            --bg-color: #1A1A1A;
            --text-color: #E0E0E0;
            --border-color: #404040;
            --primary-color: #FF69B4;
            --code-bg-color: #282828;
            --code-text-color: #E0E0E0;
            --param-bg-color: #282828;
            --param-text-color: #E0E0E0;
            --param-border-color: #404040;
            --btn-primary-bg-color: #FF69B4;
            --btn-primary-text-color: #FFFFFF;
            --btn-secondary-bg-color: #404040;
            --btn-secondary-text-color: #E0E0E0;
            --response-bg-color: #282828;
            --response-text-color: #E0E0E0;
            --response-border-color: #404040;
        }

        #rapidoc-element {
            height: calc(100vh - 200px);
            min-height: 600px;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--md-outline-variant);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="page-header">
        <div class="page-header-content">
            <a href="/admin" class="md-btn md-btn-icon" title="Back to Admin">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24"
                    height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </a>
            <div class="page-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            </div>
            <div>
                <h1 class="md-headline-medium">API Documentation</h1>
                <p class="md-body-medium md-text-secondary">Interactive API explorer - Test endpoints directly</p>
            </div>
        </div>
    </header>

    <div class="docs-container">
        <!-- Loading indicator -->
        <div id="loadingIndicator" class="loading-card">
            <div class="loading-text">Loading API documentation...</div>
            <div class="loading-subtext">Fetching OpenAPI specification from /api/openapi.json</div>
        </div>

        <!-- RapiDoc Component -->
        <rapi-doc id="rapidoc-element" spec-url="/api/openapi.json" theme="dark" render-style="read" show-header="false"
            allow-authentication="true" allow-server-selection="false" show-meta="true" show-components="true"
            show-info="true" show-servers="true" regular-font="'Roboto', -apple-system, BlinkMacSystemFont, sans-serif"
            mono-font="'Roboto Mono', monospace" font-size="14px" primary-color="#FF69B4" bg-color="#1A1A1A"
            text-color="#E0E0E0" nav-bg-color="#282828" nav-text-color="#E0E0E0" nav-hover-bg-color="#353535"
            nav-accent-color="#FF69B4" nav-hover-text-color="#FF69B4" header-color="#FF69B4" border-color="#404040"
            default-schema-tab="example" show-schema-description="true" schema-style="table" schema-expand-level="2"
            layout="column" use-path-in-nav-bar="false"></rapi-doc>
    </div>

    <script src="lib/admin-auth.js"></script>
    <script src="lib/admin-nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ API Documentation page loaded');

            const loadingIndicator = document.getElementById('loadingIndicator');
            const rapidocEl = document.getElementById('rapidoc-element');

            // Verify endpoint is accessible
            fetch('/api/openapi.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(spec => {
                    console.log('‚úÖ OpenAPI spec loaded:', spec.info?.title);
                    setTimeout(() => {
                        if (loadingIndicator) {
                            loadingIndicator.style.display = 'none';
                        }
                    }, 1000);
                })
                .catch(error => {
                    console.error('‚ùå Error loading OpenAPI spec:', error);
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = `
                            <div class="loading-text" style="color: var(--md-error);">Error loading API documentation</div>
                            <div class="loading-subtext">${error.message}</div>
                            <a href="/api/openapi.json" target="_blank" class="md-btn md-btn-outlined" style="margin-top: 16px;">
                                Try opening the spec directly
                            </a>
                        `;
                    }
                });

            // Monitor RapiDoc events
            if (rapidocEl) {
                rapidocEl.addEventListener('spec-loaded', () => {
                    console.log('‚úÖ RapiDoc spec-loaded event fired');
                    if (loadingIndicator) loadingIndicator.style.display = 'none';
                });

                rapidocEl.addEventListener('spec-error', (e) => {
                    console.error('‚ùå RapiDoc spec-error:', e.detail);
                });
            }
        });
    </script>
</body>

</html>